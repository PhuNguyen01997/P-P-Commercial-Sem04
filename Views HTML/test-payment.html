<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="/assets/plugins/jquery v3.6.0.js/jquery v3.6.0.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous">
        </script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous">
        </script>

    <!-- Font Awesome CDN -->
    <script src="https://kit.fontawesome.com/5ca78cb473.js" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="/assets/css/reset.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <link rel="stylesheet" href="/assets/css/index.css">
    <link rel="stylesheet" type="text/css" href="https://www.paypalobjects.com/webstatic/en_US/developer/docs/css/cardfields.css"/>
</head>

<body>
    <!-- JavaScript SDK -->
    <script src="https://www.paypal.com/sdk/js?components=buttons,hosted-fields&client-id=AYf5GXsKNp72_1_0UCaBAKjBdsSxRSFZCUVyxsFNq_4aRFHfh6kknaXKVJgD-DaM456uf-CY5D39E9zK"
        data-client-token="eyJicmFpbnRyZWUiOnsiYXV0aG9yaXphdGlvbkZpbmdlcnByaW50IjoiMzQ4MmZlYzYyZTI1MGUyMTI2ZjkzNzZiMThmNTc0MmNjYWE3YmUzYzVlMzFlOTMyYzUzMjBjZGE5YTRhYWMyMXxtZXJjaGFudF9pZD1yd3dua3FnMnhnNTZobTJuJnB1YmxpY19rZXk9NjNrdm4zN3Z0MjlxYjRkZiZjcmVhdGVkX2F0PTIwMjItMDEtMDZUMTU6MjM6MzQuOTA2WiIsInZlcnNpb24iOiIzLXBheXBhbCJ9LCJwYXlwYWwiOnsiaWRUb2tlbiI6ImV5SnJhV1FpT2lKbE5EQTJOakE0WWpVMFlUazBORGd4WWprMVl6YzFOREkwT0dOak1USXpaaUlzSW5SNWNDSTZJa3BYVkNJc0ltRnNaeUk2SWxKVE1qVTJJbjAuZXlKcGMzTWlPaUpvZEhSd2N6b3ZMMkZ3YVM1ellXNWtZbTk0TG5CaGVYQmhiQzVqYjIwaUxDSmhZM0lpT2xzaVkyeHBaVzUwSWwwc0ltRjFaQ0k2SWtGWlpqVkhXSE5MVG5BM01sOHhYekJWUTJGQ1FVdHFRbVJ6VTNoU1UwWmFRMVZXZVhoelJrNXhYelJoVWtaSVptZzJhMnR1WVZoTFZrcG5SQzFFWVUwME5UWjFaaTFEV1RWRU16bEZPWHBMSWl3aWNtOXNaU0k2SWsxRlVrTklRVTVVSWl3aVlYVjBhRjkwYVcxbElqb3hOalF4TkRneU5qRTFMQ0poZWlJNkltZGpjQzV6YkdNaUxDSnpZMjl3WlhNaU9sc2lRbkpoYVc1MGNtVmxPbFpoZFd4MElsMHNJbVY0Y0NJNk1UWTBNVFE0TXpVeE5Td2ljMlZ6YzJsdmJsOXBibVJsZUNJNklrNDRRbUZtVFd0R1dqbDJUR1pvY2xOeFNVNXBiakV6VTBveGVTSXNJbWxoZENJNk1UWTBNVFE0TWpZeE5Td2lhblJwSWpvaVZUSkJRVXBCYWtwTFZXOURTRWs1YVhCRFRsOVBOMFpqZEZsTE1VdFNXUzFqV2tKSmNXb3lkRUpMYWtwU1luVlZVM0JDVkdjdE1UQlZVMGMwYWxCdkxXa3hjM1ZZYlY5SExXVTVPVTR6UWxOMVdUVlVlWEZ1WTFsUGNHSkVUME5OZEVVMFIwOXpVMnRFY1VwaFNUSkJlamxKYWpKbldYSlJTalJXYkZoa1VVRWlMQ0pqYkdsbGJuUmZhV1FpT2lKQldXWTFSMWh6UzA1d056SmZNVjh3VlVOaFFrRkxha0prYzFONFVsTkdXa05WVm5sNGMwWk9jVjgwWVZKR1NHWm9ObXRyYm1GWVMxWktaMFF0UkdGTk5EVTJkV1l0UTFrMVJETTVSVGw2U3lKOS5FM1JUYkVzMFloY2VmNGhsczhtRzRGeE5nTDNHZXRDbGFjdG1EajdHYlIyS2ZVWFk5Rl9ZVEwyeVpEbHFoUUYzNFlISU5PR0tMTmFXT3NGRnpzZ242N21PZm12elQtLUE5Tl9rUFNfMWhWUllwblY4TTk0RlR5aW5ISjlxaW1xUkRnak9uYXh4WkZRSzlZcnZudVFqa1B2a1BuUlF0dW5zWlk1TVpYblZ6eW9PMW5fcG90cVVac1BMUGNTaW1nbjNtQVdJV19XMzRLRVFtdG00MFpRYmxUSGdUOUJOdHF0dy1hZzg1dVMtOFE2RkpQeVlWTGVESWVTR1g2Ulhjcnlzcm9wQ2RCZ0tSWlZTUTFoTEYxa0dxUW1YYzBCeUlOalpnaW55ZGwtR2Q5VjQ5eEhzUUtYajJyWS1ybmtWb0pyMVo3QVExRE51V2QxeFVUcFFJa0YxMEEiLCJhY2Nlc3NUb2tlbiI6IkEyMUFBS1hOU3RHdGpJWHAtODVvWVB3V3RhaUFQUlRqVVpPS3VKWWllanNGRTBYZWJFdDdQS3M3c01pc09MN3VzQmRZQThBaDEtaTFyeUVWdUlZaUYwWDhtNDc2elZtd0EifX0="></script>

    <!-- Buttons container -->
    <table border="0" align="center" valign="top" bgcolor="#FFFFFF" style="width: 39%">
        <tr>
            <td colspan="2">
                <div id="paypal-button-container"></div>
            </td>
        </tr>
        <tr>
            <td colspan="2">&nbsp;</td>
        </tr>
    </table>

    <div align="center"> or </div>

    <!-- Advanced credit and debit card payments form -->
    <div class="card_container">
        <form id="card-form">

            <label for="card-number">Card Number</label>
            <div id="card-number" class="card_field"></div>
            <div>
                <label for="expiration-date">Expiration Date</label>
                <div id="expiration-date" class="card_field"></div>
            </div>
            <div>
                <label for="cvv">CVV</label>
                <div id="cvv" class="card_field"></div>
            </div>
            <label for="card-holder-name">Name on Card</label>
            <input type="text" id="card-holder-name" name="card-holder-name" autocomplete="off"
                placeholder="card holder name" />
            <div>
                <label for="card-billing-address-street">Billing Address</label>
                <input type="text" id="card-billing-address-street" name="card-billing-address-street"
                    autocomplete="off" placeholder="street address" />
            </div>
            <div>
                <label for="card-billing-address-unit">&nbsp;</label>
                <input type="text" id="card-billing-address-unit" name="card-billing-address-unit" autocomplete="off"
                    placeholder="unit" />
            </div>
            <div>
                <input type="text" id="card-billing-address-city" name="card-billing-address-city" autocomplete="off"
                    placeholder="city" />
            </div>
            <div>
                <input type="text" id="card-billing-address-state" name="card-billing-address-state" autocomplete="off"
                    placeholder="state" />
            </div>
            <div>
                <input type="text" id="card-billing-address-zip" name="card-billing-address-zip" autocomplete="off"
                    placeholder="zip / postal code" />
            </div>
            <div>
                <input type="text" id="card-billing-address-country" name="card-billing-address-country"
                    autocomplete="off" placeholder="country code" />
            </div>
            <br /><br />
            <button value="submit" id="submit" class="btn">Pay</button>
        </form>
    </div>

    <!-- Implementation -->
    <script>
        let orderId;

        // Displays PayPal buttons
        paypal.Buttons({
            style: {
                layout: 'horizontal'
            },
            createOrder: function (data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: "1.00"
                        }
                    }]
                });
            },
            onApprove: function (data, actions) {
                return actions.order.capture().then(function (details) {
                    window.location.href = '/success.html';
                });
            }
        }).render("#paypal-button-container");

        // If this returns false or the card fields aren't visible, see Step #1.
        if (paypal.HostedFields.isEligible()) {

            // Renders card fields
            paypal.HostedFields.render({
                // Call your server to set up the transaction
                createOrder: function () {
                    return fetch('/your-server/paypal/order', {
                        method: 'post'
                    }).then(function (res) {
                        return res.json();
                    }).then(function (orderData) {
                        orderId = orderData.id;
                        return orderId;
                    });
                },

                styles: {
                    '.valid': {
                        'color': 'green'
                    },
                    '.invalid': {
                        'color': 'red'
                    }
                },

                fields: {
                    number: {
                        selector: "#card-number",
                        placeholder: "4111 1111 1111 1111"
                    },
                    cvv: {
                        selector: "#cvv",
                        placeholder: "123"
                    },
                    expirationDate: {
                        selector: "#expiration-date",
                        placeholder: "MM/YY"
                    }
                }
            }).then(function (cardFields) {
                document.querySelector("#card-form").addEventListener('submit', (event) => {
                    event.preventDefault();

                    cardFields.submit({
                        // Cardholder's first and last name
                        cardholderName: document.getElementById('card-holder-name').value,
                        // Billing Address
                        billingAddress: {
                            // Street address, line 1
                            streetAddress: document.getElementById('card-billing-address-street').value,
                            // Street address, line 2 (Ex: Unit, Apartment, etc.)
                            extendedAddress: document.getElementById('card-billing-address-unit').value,
                            // State
                            region: document.getElementById('card-billing-address-state').value,
                            // City
                            locality: document.getElementById('card-billing-address-city').value,
                            // Postal Code
                            postalCode: document.getElementById('card-billing-address-zip').value,
                            // Country Code
                            countryCodeAlpha2: document.getElementById('card-billing-address-country').value
                        }
                    }).then(function () {
                        fetch('/your-server/api/order/' + orderId + '/capture/', {
                            method: 'post'
                        }).then(function (res) {
                            return res.json();
                        }).then(function (orderData) {
                            // Three cases to handle:
                            //   (1) Recoverable INSTRUMENT_DECLINED -> call actions.restart()
                            //   (2) Other non-recoverable errors -> Show a failure message
                            //   (3) Successful transaction -> Show confirmation or thank you

                            // This example reads a v2/checkout/orders capture response, propagated from the server
                            // You could use a different API or structure for your 'orderData'
                            var errorDetail = Array.isArray(orderData.details) && orderData.details[0];

                            if (errorDetail && errorDetail.issue === 'INSTRUMENT_DECLINED') {
                                return actions.restart(); // Recoverable state, per:
                                // https://developer.paypal.com/docs/checkout/integration-features/funding-failure/
                            }

                            if (errorDetail) {
                                var msg = 'Sorry, your transaction could not be processed.';
                                if (errorDetail.description) msg += '\n\n' + errorDetail.description;
                                if (orderData.debug_id) msg += ' (' + orderData.debug_id + ')';
                                return alert(msg); // Show a failure message
                            }

                            // Show a success message or redirect
                            alert('Transaction completed!');
                        })
                    }).catch(function (err) {
                        console.log(err);
                        alert('Payment could not be captured! ' + JSON.stringify(err))
                    });
                });
            });
        } else {
            // Hides card fields if the merchant isn't eligible
            document.querySelector("#card-form").style = 'display: none';
        }
    </script>

    <script src="/assets/js/script.js"></script>
</body>

</html>